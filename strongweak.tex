\documentclass[10pt,openany]{amsproc}
\usepackage[utf8]{inputenc}
\usepackage[a4paper,hmargin={4cm,4cm},vmargin={3.5cm,3.5cm}]{geometry}
\usepackage[colorlinks=true,bookmarksopen=false,linkcolor=blue,citecolor=red]{hyperref}
\usepackage{calc} 
\usepackage{datetime}
\usepackage{comment}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amsrefs}
\usepackage{tcolorbox}
\usepackage{dsfont}
\usepackage{euscript}
\usepackage{fourier-orns}
\usepackage{datetime2}
\usepackage{palatino}
\usepackage[sc]{mathpazo}
\usepackage[T1]{fontenc}
\usepackage{graphicx}

\usepackage{tikz-cd}
\tikzcdset{
arrow style=tikz,
diagrams={>=latex}
}

\linespread{1.1}
\setlength{\parindent}{0ex}
\setlength{\parskip}{.4\baselineskip}
\definecolor{brown}{RGB}{150, 50, 10}
\definecolor{green}{RGB}{5,110, 35}

\DeclareFontFamily{OT1}{pzc}{}
\DeclareFontShape{OT1}{pzc}{m}{it}{<-> s * [1.10] pzcmi7t}{}
\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}

\newcommand{\mylabel}[1]{{\ssf{#1}}\hfill}
\renewenvironment{itemize}
  {\begin{list}{}{%
   \setlength{\parskip}{0mm}
   \setlength{\topsep}{.2\baselineskip}
   \setlength{\rightmargin}{0mm}
   \setlength{\listparindent}{0mm}
   \setlength{\itemindent}{0mm}
   \setlength{\labelwidth}{2ex}
   \setlength{\itemsep}{.1\baselineskip}
   \setlength{\parsep}{0mm}
   \setlength{\partopsep}{0mm}
   \setlength{\labelsep}{1ex}
   \setlength{\leftmargin}{\labelwidth+\labelsep}
   \let\makelabel\mylabel
   }}
   {\vspace*{-.3\baselineskip}\end{list}}

\def\E{\exists}
\def\A{\forall}
\def\mdot{\mathord\cdot}
\def\models{\vDash}
\def\notmodels{\nvDash}
\def\proves{\vdash}
\def\notproves{\nvdash}
\def\ZZ{\mathds Z}
\def\NN{\mathds N}
\def\QQ{\mathds Q}
\def\RR{\mathds R}
\def\BB{\mathds B}
\def\CC{\mathds C}
\def\PP{\mathds P}
\def\Ar{{\rm Ar}}
\def\dom{\mathop{\rm dom}}
\def\range{\mathop{\rm rng}}
\def\rank{\mathop{\rm rank}}
\def\dcl{\mathop{\rm dcl}}
\def\acl{\mathop{\rm acl}}
\def\fp{{\rm fp}}
\def\cf{\mathop{\rm cf}}
\def\rad{\mathop{\rm rad}}
\def\eq{{{\rm eq}}}
\def\ccl{{\rm ccl}}
\def\Th{{\rm Th}}
\def\Diag{{\rm Diag}}
\def\Mod{\mathop{\rm Mod}}
\def\Rmod{{\mbox{\scriptsize $R$-mod}}}
\def\Aut{{\rm Aut\kern.15ex}}
\def\Autf{\mathord{\rm Aut\kern.15ex{f}\kern.15ex}}
\def\Cb{{\rm Cb\kern.15ex}}
\def\orbit{\O}
\def\oorbit{\mathpzc{o}}
\def\oorbitf{\mathpzc{of\!}}
\def\id{{\rm id}}
\def\tp{{\rm tp}}
\def\qftp{{\rm qf\mbox{-}tp}}
\def\attp{{\rm at\mbox{-}tp}}
\def\atpmtp{\mbox{\rm at$^{\scriptscriptstyle\pm}$-tp}}
\def\Deltatp{\Delta\mbox{\rm -tp}}
\def\pmDelta{\Delta\hskip-.3ex\raisebox{1ex}{$\scriptscriptstyle\pm$}}
\def\pmDeltatp{\noindent\pmDelta\hskip-.3ex{\rm -tp}}
\def\EMtp{\mbox{{\small EM}-tp}}

\def\nonfork{\mathop{\raise0.2ex\hbox{\ooalign{\hidewidth$\vert$\hidewidth\cr\raise-0.9ex\hbox{$\smile$}}}}}

\def\cnonfork{\mathbin{\raise1.8ex\rlap{\kern0.6ex\rule{0.6ex}{0.1ex}}\rlap{\kern1.1ex\rule{0.1ex}{1.9ex}}\raise-0.3ex\hbox{$\smile$} } }

\def\nonforkc{\mathbin{\raise1.8ex\rlap{\kern1.1ex\rule{0.6ex}{0.1ex}}\rlap{\kern1.1ex\rule{0.1ex}{1.9ex}}\raise-0.3ex\hbox{$\smile$} } }

\def\QED{}
\def\cpaw{\mathbin{\ooalign{\kern-0.4ex$-$\hidewidth\cr$<$}}}
\def\cpawdot{\ooalign{$\kern1.2ex\cdot$\cr$\cpaw$\cr}}
\def\cev#1{\reflectbox{\ensuremath{\vec{\reflectbox{\ensuremath{#1}}}}}}

\def\sm{\smallsetminus}
\def\atpmL{L_{\rm at^{\scriptscriptstyle\pm}}}
\def\qfL{L_{\rm qf}}
\def\atL{L_{\rm at}}
\def\simdiff{\triangle}
\def\IMP{\Rightarrow}
\def\PMI{\Leftarrow}
\def\IFF{\Leftrightarrow}
\def\NIFF{\nLeftrightarrow}
\def\imp{\rightarrow}
\def\pmi{\leftarrow}
\def\iff{\leftrightarrow}
\def\niff{\mathrel{{\leftrightarrow}\llap{\raisebox{-.1ex}{{\small$/$}}\hskip.5ex}}}
\def\nequiv{\mathrel{\mbox{$\equiv$\llap{{\small$/$}\hskip.3ex}}}}
\def\equivEM{\stackrel{\smash{\scalebox{.5}{\rm EM}}}{\equiv}}
\def\equivL{\stackrel{\smash{\scalebox{.5}{\rm L}}}{\equiv}}
\def\equivKP{\stackrel{\smash{\scalebox{.5}{\rm KP}}}{\equiv}}
\def\equivSh{\stackrel{\smash{\scalebox{.5}{\rm Sh}}}{\equiv}}

\def\isomap{\mathrel{\rlap{\kern0.7ex\raisebox{.7ex}{\scriptsize$\kern.2ex\sim$}}\rightarrow}}

\def\P{\EuScript P}
\def\D{\EuScript D}
\def\Aa{\EuScript A}
\def\Ee{\EuScript E}
\def\X{\EuScript X}
\def\Y{\EuScript Y}
\def\Z{\EuScript Z}
\def\C{\EuScript C}
\def\U{\EuScript U}
\def\Hh{\EuScript H}
\def\I{\EuScript I}
\def\V{\EuScript V}
\def\W{\EuScript W}
\def\R{\EuScript R}
\def\F{\EuScript F}
\def\G{\EuScript G}
\def\B{\EuScript B}
\def\M{\EuScript M}
\def\Ll{\EuScript L}
\def\K{\EuScript K}
\def\O{\EuScript O}
\def\J{\EuScript J}
\def\S{\EuScript S}
\def\<{\langle}
\def\>{\rangle}
\def\0{\varnothing}
\def\theta{\vartheta}
\def\phi{\varphi}
\def\epsilon{\varepsilon}
\def\ssf#1{\textsf{\small #1}}

\newtheoremstyle{mio}% name
     {2\parskip}     % Space above
     {2\parskip}     % Space below
     {}%         Body font
     {}%         Indent amount (empty = no indent, \parindent = para indent)
     {\bfseries}% Thm head font
     {}%        Punctuation after thm head
     {1ex}%     Space after thm head: " " = normal interword space;
           %   \newline = linebreak
     {\llap{\thmnumber{#2}\hskip0.9ex}\thmname{#1}\thmnote{\bfseries{}#3}}% Thm head spec (can be left empty, meaning `normal')

\newcounter{thm}

\renewcommand{\thethm}{\arabic{thm}}

\tcbset{
  mythm/.style={
    colback=black!5!white,
    colframe=white!50!black,
    extrude right by=1ex,
    extrude left by=6.5ex,
    % before=\par\noindent,
    % after=\par\noindent,
    top=0.7ex,
    bottom=1.5ex,
    right=1ex,
    left=6.5ex,
    boxsep=0pt,
    parbox=false,
    before skip=\baselineskip,
    after skip=\baselineskip,
  },
}
\theoremstyle{mio}
\newtheorem{theorem}[thm]{Theorem}\tcolorboxenvironment{theorem}{mythm}
\newtheorem{corollary}[thm]{Corollary}\tcolorboxenvironment{corollary}{mythm}
\newtheorem{proposition}[thm]{Proposition}\tcolorboxenvironment{proposition}{mythm}
\newtheorem{lemma}[thm]{Lemma}\tcolorboxenvironment{lemma}{mythm}
\newtheorem{fact}[thm]{Fact}\tcolorboxenvironment{fact}{mythm}
\newtheorem{definition}[thm]{Definition}\tcolorboxenvironment{definition}{mythm}
\newtheorem{assumption}[thm]{Assumption}\tcolorboxenvironment{assumption}{mythm}
\newtheorem{void}[thm]{}\tcolorboxenvironment{void}{mythm}
\newtheorem{remark}[thm]{Remark}\tcolorboxenvironment{remark}{mythm}
\newtheorem{notation}[thm]{Notation}\tcolorboxenvironment{notation}{mythm}
\newtheorem{note}[thm]{Note}\tcolorboxenvironment{note}{mythm}
\newtheorem{exercise}[thm]{Exercise}
\newtheorem{example}[thm]{Example}\tcolorboxenvironment{example}{mythm}

\makeatletter
\providecommand{\proofNameStyle}{\bfseries}
\renewenvironment{proof}[1][\proofname]{\par
  \pushQED{\qed}%
  \normalfont% \topsep6\p@\@plus6\p@\relax
  % \vspace*{-\baselineskip}
  \trivlist
  \item[\hskip\labelsep
        \proofNameStyle
    #1\@addpunct{.}]\ignorespaces
}{%
  \popQED\endtrivlist\@endpefalse
}
\makeatother

\pagestyle{plain}

\definecolor{green}{RGB}{5,110, 35}
\definecolor{emphcolor}{rgb}{.90,.98,.98}

\def\mr{\color{brown}}
\def\gr{\color{green}}
\def\vl{\color{violet}}

\def\mrA{{\mr\Aa}}
\def\mrB{{\mr\B}}
\def\mrC{{\mr\C}}
\def\mrD{{\mr\D}}
\def\mrG{{\mr\G}}
\def\mrU{{\mr\U}}
\def\mrV{{\mr\V}}
\def\mrW{{\mr\W}}
\def\mrX{{\mr\X}}
\def\grB{{\gr\B}}
\def\grC{{\gr\C}}
\def\grD{{\gr\D}}
\def\grG{{\gr\G}}
\def\grZ{{\gr\Z}}
\def\grV{\V^{\gr z}}

\renewcommand*{\emph}[1]{%
\kern-0.3ex
\smash{\tikz[baseline]\node[rectangle, fill=black!20!yellow!50!white, rounded corners, inner xsep=0.5ex, inner ysep=0.2ex, anchor=base, minimum height = 2.7ex]{#1};}\kern-0.5ex
}

%%%%%%% GETCOMMIT
\newcommand\dotGitHEAD{}
\newcommand\branch{}
\newcommand\commit{}
\makeatletter
\let\myfilehandle\@inputcheck\makeatother

\openin\myfilehandle=.git/HEAD\relax

\begingroup\endlinechar-1
  \global\read\myfilehandle to \dotGitHEAD
\endgroup
\closein\myfilehandle

\newcommand\GetBranch{}
\def\GetBranch ref: refs/heads/#1\relax{\renewcommand{\branch}{#1}}

\expandafter\GetBranch\dotGitHEAD\relax
\makeatother
%%%%%%% END GETCOMMIT

% \author{S. A. Polymath}

\begin{document}
\author{G.\ A.\ Polymath}
\title{Group actions on models}
\hfill\texttt{Branch:\ \branch\ \DTMnow}
\maketitle
\raggedbottom
\begin{abstract}
  \setlength{\parindent}{0ex}
  \setlength{\parskip}{.4\baselineskip}
  I say that, a set is \textit{strongly generic\/} if the intersection of any finitely many of its translation is generic.
  To demostrate the interest of this notion I use it for a short proof of (a generalization of) Newelski's theorem on the diamter of the Lascar graph, see Theorem~\ref{thm_newelski}.

  Theorem~\ref{thm_coalesce} shows that the condition \textit{strongly generic = generic\/} is roboust and may have some interest (it is reminiscent of \textit{forking = dividing\/}).

  Section~\ref{definable} is incomplete.
  I would like to recover in a natural way the classical stable group theory but I am missing something.
  
  The connections with topological dynamics are commented at the end of the notes.
\end{abstract}

\def\medrel#1{\parbox[t]{5ex}{$\displaystyle\hfil #1$}}
\def\ceq#1#2#3{\parbox[t]{17ex}{$\displaystyle #1$}\medrel{#2}{$\displaystyle #3$}}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The two perspectives on the invariance of types}

This section I review well-known matter and set the terminology.

Below $\Delta\subseteq L_{{\mr x}\,{\gr z}}(\U)$, ${\mrX}\subseteq\U^{\mr x}$, and ${\grZ}\subseteq\U^{\gr z}$ are some arbitrary nonempty sets (at some point we will require that $\mrX$ and $\grZ$ are type-definable).
We write $L_\Delta({\grZ})$ for the set of formulas $\theta({\mr x})$ that are Boolean combination of formulas $\phi({\mr x}\;{\gr b})$ for some $\phi({\mr x}\;{\gr z})\in\Delta$ and some ${\gr b}\in{\grZ}$.
Such formulas a called $\Delta$-formulas.
A relatively $\Delta$-definable set is a set of the form $\theta(\mrX)$ for some $\Delta$-formula $\theta({\mr x})$.
Subsets of $L_\Delta({\grZ})$ are called $\Delta$-types.
We write $S_\Delta({\grZ})$ for the set of complete $\Delta$-types with parameters in $\grZ$. Beware that there may be other parameters hidden ion $\Delta)$.

\begin{assumption}\label{notation_GXphi}
  Let $G$ be a group that acts on $\mrX$ and on $\grZ$ from the left.
  We require that for every $\phi({\mr x}\,;{\gr z})\in\Delta$ the set $\phi(\mrX;\grZ)$ is invariant under the action of $G$.
\end{assumption}

Let $\grD\subseteq\U^{\gr z}$.
We say that $\grD$ is \emph{invariant\/} under the action of $G$, or \emph{$G$-invariant,} if $\grD\cap\grZ$ is fixed setwise by $G$.
Yet in other words, if

\ceq{\ssf{is1.}\hfill {\gr a}\in\grD}{\iff}{g{\gr a}\in\grD}\hfill for every ${\gr a}\in\grZ$ and every $g\in G$.

A formula is invariant if the set it defines is invariant.
We say that $p({\mr x})\subseteq L(\U)$ is \emph{invariant\/} under the action of $G$, or \emph{$G$-invariant,} if for every formula $\phi({\mr x}\,;{\gr z})\in L$ 

\ceq{\ssf{it1.}\hfill\phi({\mr x}\,;{\gr a})\in p}{\IFF}{\phi({\mr x}\,;g{\gr a})\in p}\hfill for every ${\gr a}\in\grZ$ and every $g\in G$.

It should be evident that invariant under the action of $\Aut(\U/A)$ coincides with invariant over $A$ and Lascar invariant over $A$ coincides with invariant under the action of $\Autf(\U/A)$.

We have just defined invariance using the subsets of $\grZ$ (externally) defined by $p$.
Now we discuss invariance using the subsets of $\mrX$ that are in $p$.

An immediate consequence of Assumption~\ref{notation_GXphi} is that any $G$-translate of a $\Delta$-definable set is again $\Delta$-definable.
In particular for every $\Delta$-formula $\theta({\mr x}\,;{\gr\bar b})$ and every $g\in G$

\ceq{\hfill g[\theta(\mrX\,;{\gr\bar b})]}{=}{\theta(\mrX\,;g{\gr\bar b}).}

Therefore $p({\mr x})\subseteq L_\Delta(\grZ)$ is invariant if

\ceq{\hfill p({\mr x})\proves{\mr x}\in\mrD}{\IFF}{p({\mr x})\proves{\mr x}\in g\mrD}\hfill for every $\Delta$-definable $\mrD\subseteq\U^{\mr x}$ and $g\in G$,

where by $p({\mr x})\proves{\mr x}\in\mrD$ we understand $\theta(\mrX)\subseteq\mrD$ for some $\theta({\mr x})$ that is conjunction of formulas in $p({\mr x})$.

A set $\mrD\subseteq\mrX$ is \emph{generic\/} under the action of $G$, or \emph{$G$-generic\/} for short, if finitely many $G$-translates of $\mrD$ cover $\mrX$; we say \emph{$n$-$G$-generic\/} if $\le n$ translates suffices.
Dually, we say that $\mrD$ is \emph{persistent\/} under the action of $G$, or \emph{$G$-persistent\/} for short, if the intersection of any finitely many $G$-translates of $\mrD$ is nonempty; we say \emph{$n$-$G$-persistent\/} when the request is limited to $\le n$ translates.
We will drop reference to $G$ when it is clear from the context.

The same properties may be attributed to formulas (as these are identified with the set they define).
When these properties are attributed to a type $p({\mr x})$, we understand that they hold for every conjunction of formulas in $p({\mr x})$.
% See Exercise~\ref{ex_persistent_types} for an alternative characterization when $p({\mr x})$ is small.

The terminology is mine.
In~\cite{CK} the authors write \textit{quasi-non-dividing\/} for \textit{persistent\/} when $G=\Aut(\U/A)$.

\begin{example}
  If $p({\mr x})\subseteq L(\U)$ is finitely satisfiable in $A$ then $p({\mr x})$ is persistent (in any $\mrX\supseteq A^{\mr x}$) under the action of $\Aut(\U/A)$.
  In fact, the same ${\mr a}\in A^{\mr x}$ that satisfies $\phi({\mr x})$ also satisfies every $\Aut(\U/A)$-translate of $\phi({\mr x})$.
\end{example}

In this chapter many proofs require some juggling with negations.

\begin{fact}\label{fact_fip}
  (Assume~\ref{notation_GXphi})\ \  
  The following are equivalent
  \begin{itemize}
    \item[1.] $\mrD$ is not $n$-generic
    \item[2.] $\neg\mrD$ is $n$-persistent.
  \end{itemize}
\end{fact}

\begin{proof}
  Immediate by spelling out the definitions\smallskip
  \begin{itemize}
    \item[1.] there are no $g_1,\dots,g_n\in G$ such that \smash{$\displaystyle\mrX\ \subseteq\ \bigcup_{i=1}^n g_i{\mr\D}$}
    \item[2.]  $\displaystyle\0\ \neq\ \mrX\,\cap\,\bigcap_{i=1}^n\neg g_i{\mr\D}$ for every $g_1,\dots,g_n\in G$.\qedhere
  \end{itemize} 
\end{proof}

\begin{theorem}\label{thm_generic_invariant}
  (Assume~\ref{notation_GXphi})\ \  
  Let $p({\mr x})\in S_\Delta(\grZ)$ be finitely satisfiable in $\mrX$.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] $p({\mr x})$ is invariant
    \item[2.] $p({\mr x})\proves{\mr x}\in\mrD$ for every generic relatively $\Delta$-definable set $\mrD$
    \item[3.] $p({\mr x})$ is persistent.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  Let $g_1{\mr\D},\dots,g_n{\mr\D}$ be translations of $\mrD$ that cover $\mrX$.
  Negate \ssf2.
  By completeness, $p({\mr x})\proves {\mr x}\notin\mrD$.
  Hence, from invariance we obtain

  \ceq{\hfill p({\mr x})}{\proves}{{\mr x}\ \notin\ \bigcup_{i=1}^ng_i\mrD.}

  This contradicts the finite satisfiability of $p({\mr x})$ in $\mrX$.
  
  \ssf2$\IMP$\ssf3.
  Let $\mrD$ be defined by a conjunction of formulas in $p({\mr x})$.
  If $\mrD$ is not persistent then, by Fact~\ref{fact_fip}, $\neg\mrD$ is generic. 
  By \ssf2, $p({\mr x})\proves{\mr x}\notin\mrD$, a contradiction.

  \ssf3$\IMP$\ssf1.
  % uppose $p({\mr x})$ is not $(n+2)$-persistent and let $n$ be minimal.
  % Let $g_1,\dots,g_{n+2}\in G$ and $\theta({\mr x})\,;{\gr\bar b}$ witness this.
  % Then 
  If $p({\mr x})$ is not invariant then, by completeness, $p({\mr x})\proves\phi({\mr x}\,;{\gr b})\wedge\neg\phi({\mr x}\,;g{\gr b})$ for some $g\in G$.
  Clearly $\phi({\mr x}\,;{\gr b})\wedge\neg\phi({\mr x}\,;g{\gr b})$ is not persistent as it is inconsistent with its $g$-translate.
\end{proof}

\begin{remark}
  In the theorem above, \ssf2 and \ssf3 can be replaced by
  \begin{itemize}
    \item[2$'$\!.] $p({\mr x})\proves{\mr x}\in\mrD$ for every 2-generic relatively $\Delta$-definable set $\mrD$
    \item[3$'$\!.] $p({\mr x})$ is 2-persistent.
  \end{itemize}
\end{remark}

The theorem yields an immediate necessary condition for the existence of an invariant global $\Delta$-type.

\begin{corollary}
  (Assume~\ref{notation_GXphi})\ \  
  If there exists an invariant global $\Delta$-type then for every $\Delta$-definable set $\mrD$
  \begin{itemize}
    \item[1.] $\mrD$ and $\neg\mrD$ cannot be both generic
    \item[2.] if $\mrD$ is generic than it is persistent.
  \end{itemize}
\end{corollary}

\begin{proof}
  By Fact~\ref{fact_fip}, \ssf1 and \ssf2 are equivalent; \ssf1 is an immediate consequenc of \ssf2 of Theorem~\ref{thm_generic_invariant}.
\end{proof}

The following theorem gives a necessary and sufficient condition for the  existence of global invariant $\Delta$-type.
Ideally, we would like to prove that every persistent $\Delta$-type extends to a global persitent type.
Unfortunately this is not true -- we need a stronger property.
A $\Delta$-definable set $\mrD$ is \emph{hereditarely persistent\/} if every finite cover of $\mrD$ by $\Delta$-definable sets contains a persistent set.
A type is hereditarely persistent if every conjunction of formulas in the type is hereditarely persistent.

% \noindent\llap{\textcolor{red}{\Large\warning}\kern1.5ex}\ignorespaces
The terminology is provisional.
In~\cite{CK} a related property is called \textit{quasi-non-forking.}

\begin{theorem}\label{thm_generic_invariant2}
  (Assume~\ref{notation_GXphi})\ \  
  Let $q({\mr x})\subseteq L(\U)$.
  Then the following are equivalent 
  \begin{itemize}
    \item[1.] $q({\mr x})$ extends to an invariant type $p({\mr x})\in S_\Delta(\grZ)$ finitely satisfiable in $\mrX$
    \item[2.] $q({\mr x})$ is hereditarely persistent.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  Let $\theta({\mr x})$ be a conjunction of formulas in $q({\mr x})$.
  Suppose ${\mr\C_1},\dots,{\mr\C_n}$ cover $\theta(\U^{\mr x})$ and pick $p({\mr x})$ as in \ssf1.
  By completeness, $p({\mr x})\proves {\mr x}\in{\mr\C_i}$ for some $i$.
  Then, by Theorem~\ref{thm_generic_invariant}, $\neg{\mr\C_i}$ is not generic.
  Therefore, by Fact~\ref{fact_fip}, ${\mr\C_i}$ is persistent.

  \ssf2$\IMP$\ssf1.
  Let $p({\mr x})$ be maximal among the $\Delta$-types that contain $q({\mr x})$ and are such that $\theta(\U^{\mr x})$ is hereditarely persistent for every $\theta({\mr x})$ that is conjunction of formulas in $p({\mr x})$.
  We claim that $p$ is a complete $\Delta$-type.
  Suppose for a contradiction that $\theta({\mr x}),\neg\theta({\mr x})\notin p$.
  By maximality there is some formula $\psi({\mr x})$, a conjunction of formulas in $p({\mr x})$ and some ${\mr\C_1},\dots,{\mr\C_n}$ that cover both $\psi(\U^{\mr x})\cap\theta(\U^{\mr x})$ and $\psi(\U^{\mr x})\smallsetminus\theta(\U^{\mr x})$ and such that no ${\mr\C_i}$ is persistent.
  As ${\mr\C_1},\dots,{\mr\C_n}$ cover $\psi(\U^{\mr x})$ this is a contradiction.
  It is only left to show that $p({\mr x})$ is finitely satisfiable in $\mrX$ and invariant.
  Finite satisfiability follows from persistency.
  From completeness and Theorem~\ref{thm_generic_invariant} we obtain invariance.
\end{proof}

% \begin{exercise}\label{ex_persistent_types}
%   Prove that for every $p(x)\subseteq L_\phi(A)$ following are equivalent
%   \begin{itemize}
%     \item[1.] $p(x)$ is persistent
%     \item[2.] $p(\U^x)$ is persistent.
%   \end{itemize}
% \end{exercise}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Strong genericity}\label{strong_genericity}

Unfortunatelly, genericy is not preserved under intersection.
To obtain closure under intersection, we need to push the concept to a higher level of complexity.

A set $\mrD\subseteq\U^{\mr x}$ is \emph{strongly generic\/} if the intersection of $\mrD$ with any of its tranlations $\mrD$ is generic.
Dually, we say that $\mrD$ is \emph{weakly persistent\/} if the union of $\mrD$ with one of its translations is peristent.
Again, the same properties may be attributed to formulas and types.

Notation: for $\mrB\subseteq\mrX$ and $H\subseteq G$ we write $H\,\mrB$ for $\{h\mrB: h\in H\}$.

\begin{lemma}\label{lem_strongly_generic}
  (Assume~\ref{notation_GXphi})\ \  
  The intersection of strongly generic sets is strongly generic.
\end{lemma}

\begin{proof}
  We may assume that all sets mentioned below are subsets of $\mrX$.
  Let ${\mr\D}$ and ${\mr\C}$ be strongly generic and let $K\subseteq G$ be an arbitrary finite set.
  It suffices to prove that $\mrB=\cap\, K\,({\mr\C}\cap{\mr\D})$ is generic. 
  Clearly $\mrB={\mr\C'}\cap{\mr\D'}$, where ${\mr\C'}=\cap\, K\,{\mr\C}$ and ${\mr\D'}=\cap\, K\,{\mr\D}$.
  Note that ${\mr\C'}$ and ${\mr\D'}$ are both strongly generic.
  In particular $\mrX=\cup\,H\,\mr\D'$ for some finite $H\subseteq G$.
  Now, from
  
  \ceq{\hfill\cup\,H\,\mrB}{=}{\cup\,H\Big[{\mr\C'}\ \cap\ {\mr\D'}\Big]}

  \ceq{\hfill\cup\,H\,\mrB}{\supseteq}{\cup\,H\Big[\big(\cap\, H\,{\mr\C'}\big)\ \cap\ {\mr\D'}\Big]}
  
  \ceq{}{=}{ \big(\cap\, H\,{\mr\C'}\big)\ \cap\ \big(\cup\,H\,{\mr\D'}\big)}
  
  \ceq{}{=}{\cap\, H\,{\mr\C'}}
  
  As ${\mrC'}$ is strongly generic, $\cap\, H\,{\mr\C'}$ is generic.
  Therefore $\cup\,H\,\mrB$ is also generic.
  The genericity of $\mrB$ follows.
\end{proof}

\begin{corollary}\label{corol_str_gen}
  (Assume~\ref{notation_GXphi})\ \  
  Let $q({\mr x})=\{\theta({\mr x})\in L_\phi(\U)\,:\, \theta({\mr x})\textrm{ strongly generic}\}$.
  Then $q({\mr x})$ is finitely satisfiable in $\mrX$, strongly generic, and invariant.
\end{corollary}

\begin{proof}
  Strong genericity is an immediate consequence of Lemma~\ref{lem_strongly_generic}.
  Finite satisfiability follows easily from genericity.
  As for invariance, note that any translate of a strongly generic formula is also strongly generic.
\end{proof}

\begin{corollary}\label{corol_q_w_pers}
  (Assume~\ref{notation_GXphi})\ \  
  Let $q({\mr x})$ be as in Corollary~\ref{corol_str_gen}.
  Let $p({\mr x})\subseteq L(\U)$ be such that $p({\mr x})\cup q({\mr x})$ is finitely satisfied in $\mrX$.
  Then $p({\mr x})$ is weakly persistent.
\end{corollary}

\begin{proof}
  Let $\theta({\mr x})\in p$.
  As $q({\mr x})$ is finitely satisfiable in $\theta(\U^{\mr x})$, we cannot have that $\neg\theta({\mr x})$ is strongly generic.
  From Fact~\ref{fact_fip}, we obtain that $\neg\theta(\U^{\mr x})$ non strongly generic is equivalent to $\theta({\mr x})$ weakly persistent.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The diameter of a Lascar type}\label{newelski}

Recall that $\Ll({\mr a}/A)$, the Lascar strong type of ${\mr a}\in\U^{\mr x}$, is the union of a chain of type-definable sets of the form $\big\{{\mr x}\ :\ d_A({\mr a},{\mr x})\le n\big\}$.
In this section we prove that $\Ll({\mr a}/A)$ is type-definable (if and) only this chain is finite.
In other words, only if the connected component of ${\mr a}$ in the Lascar graph has finite diameter.
It is convenient to address the problem in more general terms.

Let $G$ be a normal subgroup of $\Aut(\U)$.
Let $K\subseteq G$ generate $G$ and is
\begin{itemize}
  \item[1.] symmetric i.e.\@ it contains the unit and is closed under inverse
  \item[2.] conjugancy invariant i.e.\@ $g\,K^{-1}=K$ for every $g\in G$
\end{itemize}

Needless to say we have 

\begin{itemize}
  \item[3.] $K^nK^m=K^{n+m}$ for every $n,m\in\omega$.
\end{itemize}

Assume $G$ acts transitively on $\mrX$ i.e., $G\,{\mr a}=\mrX$ for every ${\mr a}\in\mrX$.
We define a discrete metric on $\mrX$.
For ${\mr a},{\mr b}\in\mrX$ let $d({\mr a},{\mr b})$ be the minimal $n$ such that ${\mr a}\in K^n{\mr b}$.
This defines a metric by \ssf1 and \ssf3.
By \ssf2, this metric in $G$-invariant.
The \emph{diameter\/} of a set $\mrC\subseteq\mrX$ is the supremum of $d({\mr a},{\mr b})$ for ${\mr a},{\mr b}\in\mrC$.

We are interested in sufficient conditions for $\mrX$ to have finite diameter.
The notions introduced in Section~\ref{strong_genericity} offer some hints.

\begin{proposition}\label{prop_wpers_finite_diameter}
  If $\mrX$ has a weakly persistent subset of finite diameter, then $\mrX$ itself has finite diamenter.
\end{proposition}

\begin{proof}
  Let $\mrC\subseteq\mrX$ be a weakly persistent set of diameter $n$.
  Let $H\subseteq G$ be finite such that $\cup\,H\,\mrC$ is persistent.
  We claim that also $\cup\,H\,\mrC$ has finite diameter.
  Let ${\mr a}\in\mrC$ be arbitrary.
  Let $m$ be larger than $d(h{\mr a}, k{\mr a})$ for all $h,k,\in H$.
  Now, let $h{\mr b}$ and $k{\mr c}$, for some $h,k,\in H$ and ${\mr b},{\mr c}\in\mrC$, be two arbitrary elements of $\cup\,H\,\mrC$.
  As $h\mrC$ and $k\mrC$ have the same diameter of $\mrC$, 

  \ceq{\hfill d(h{\mr b},\, k{\mr c})}{\le}{d(h{\mr b},\,h{\mr a})\ +\ d(h{\mr a},\, k{\mr a})\ +\ d(k{\mr a},\,k{\mr c})}

  \ceq{}{\le}{n+m+n.}

  This proves that $\cup\,H\,\mrC$ has finite diameter.
  Therefore, without loss of generality, we may assume that $\mrC$ itself is persistent.
  
  By the transitivity of the action, any two elements of $\mrX$ are of the form $h{\mr a}$, $k{\mr a}$ for some $h,k\in G$ and some ${\mr a}\in\mrC$.
  By percistency, there are ${\mr c}\in\mrC\cap h\mrC$ and ${\mr d}\in\mrC\cap k\mrC$.
  Then 

  \ceq{\hfill d(h{\mr a},\, k{\mr a})}{\le}{d(h{\mr a},\,{\mr c})\ +\ d({\mr c},\, {\mr d})\ +\ d({\mr d},\,k{\mr a})}

  \ceq{}{\le}{n+n+n.}

  Therefore the diameter of $\mrX$ does not exceed $3n$.
\end{proof}

\begin{theorem}\label{thm_newelski}
  Suppose that $\mrX$ and the sets ${\mr\X_n}=K^n{\mr a}$, for some ${\mr a}\in\mrX$, are type-definable.
  Then $\mrX$ has finite diameter.
\end{theorem}

\begin{proof}
  By Proposition~\ref{prop_wpers_finite_diameter}, it suffices to prove that ${\mr\X_n}$ is weakly persistent.
  Define

  \ceq{\hfill q({\mr x})}{=}{\{\theta({\mr x})\in L(\U)\ :\ \theta({\mr x})\textrm{ strongly generic}\}.}
  
  By Corollary~\ref{corol_q_w_pers}, with $L$ for $L_\phi$, it suffices to prove that for some $n$ the type $q({\mr x})$ is finitely satisfied in $\mr\X_n$.
  Suppose not.
  Let $\psi_n({\mr x})\in q$ be a formula that is not satisfied in $\mr\X_n$.
  The type $p({\mr x})=\{\psi_n({\mr x}):n\in\omega\}$ is finitely satisfied in $\mrX$.
  Then $p({\mr x})$ has a realization in $\mrX$. 
  As this realization belongs to some ${\mr\X_n}$ we contradict the definition of $\psi_n({\mr x})$. 
\end{proof}

% \ceq{\hfill p_n({\mr\X},{\mr\X})}{=}{\{\<{\mr a},{\mr b}\>\in{\mr\X^2}\ :\ {\mr a}\in K^n{\mr b}\}}

% Below we write ${\mr x}\in K^n{\mr y}$ for the type $p_n({\mr x},{\mr y})$ and ${\mr x}\in G\,{\mr y}$ for the disjunction of all these types (n.b.\@ an infinite disjunction of types need not be a type).

\begin{example}
  Let $K\subseteq\Aut(\U/A)$ be the set of automorphisms that fix a model containing $A$.
  Then the group $G$ generated by $K$ is $\Autf(\U/A)$ and $G\cdot{\mr a}=\mrX$ is $\Ll({\mr a}/A)$.
  If we let $K$ be the set of automorphisms that fix a model $M\supseteq A$ and $K^n=K^n$, then $d({\mr a},{\mr b})$ concides with the dinstance in the Lascar graph.
  It is not difficult to see that the sets $K^n\cdot{\mr a}$ are type definable.
  Then from Theorem~\ref{thm_newelski} it follows that $\Ll({\mr a}/A)$ is type definable (if and) only if it has a finite diameter.
\end{example} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A simplified landscape}

Under suitable assumptions -- e.g.\@ the sability of $\phi({\mr x}\,;{\gr z})$ -- some of the notions introduced above coalesce and we are left with cleaner theory.
We prove the following theorem.

\begin{theorem}\label{thm_coalesce}
  (Assume~\ref{notation_GXphi})\ \  
  The following are equivalent
  \begin{itemize}
    \item[1.] persistent $\Delta$-definable sets are hereditarely persistent
    \item[2.] generic $\Delta$-definable sets are strongly generic
    \item[3.] generic $\Delta$-definable sets are closed under intersection
    \item[4.] weakly persisent $\Delta$-definable sets are persistent.
  \end{itemize}
\end{theorem}

\begin{proof}
  \ssf1$\IMP$\ssf2.
  It suffices to prove that generic sets are closed under intersection.
  Let $\mrC$ and $\mrD$ be generic $\Delta$-definable sets.
  Suppose for a contradiction that $\mrC\cap\mrD$ is not generic.
  By \ssf1 and Theorem~\ref{thm_generic_invariant2} there is an invariant global $\Delta$-type $p({\mr x})$ containing ${\mr x}\in\neg\mrC\cup\neg\mrD$.
  By completeness either $p({\mr x})\proves{\mr x}\in\neg\mrC$ or $p({\mr x})\proves{\mr x}\in\neg\mrD$.
  This is a contradiction because, by Theorem~\ref{thm_generic_invariant}, $p({\mr x})\proves{\mr x}\in\mrC$ and $p({\mr x})\proves{\mr x}\in\mrD$.

  \ssf2$\IFF$\ssf3$\IFF$\ssf4. Clear.

  \ssf4$\IMP$\ssf1.
  Let $q({\mr x})=\{\theta({\mr x})\in L_\phi(\U)\,:\,\theta({\mr x})\textrm{ generic}\}$.
  By \ssf2 this is the same type defined in Corollary~\ref{corol_q_w_pers}.
  Therefore, any completion of $q({\mr x})$ is, by \ssf4, persistent.
  Let $\mrD$ be a persistent $\Delta$-definable set.
  By Theorems~\ref{thm_generic_invariant} and~\ref{thm_generic_invariant2} it suffices to show that $\mrD$ is consistent with $q({\mr x})$.
  Suppose not, then $q({\mr x})\proves {\mr x}\in\neg\mrD$.
  Therefore, by \ssf3, $\neg\mrD$ is generic.
  This is a contradiction by Fact~\ref{fact_fip}.
\end{proof}

\begin{remark}\label{rem_coalesce}
  Assume the equivalent conditions in Theorem~\ref{thm_coalesce}.
  Then there is a unique maximal syndetic type $q({\mr x})\subseteq L_\Delta(\grZ)$.
  Moreover the following are equivalent for every $p({\mr x})\in S_\Delta(\grZ)$
  \begin{itemize}
    \item[1.] $p({\mr x})$ is persistent (equivalently, invariant)
    \item[2.] $p({\mr x})$ extends $q({\mr x})$.
  \end{itemize}
  In particular, invariant global types exist.
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Definable groups}\label{definable}

We work under Assumption~\ref{notation_GXphi} but with further requirement on $G$ and $\Delta$.

In this section we set $G=\grZ$ and require that $\grZ$ and $\mrX$ are type-definable over $A$.
We assume that the group operations and the group action are definable over $A$.
We use the symbol $\,\cdot\,$ for both the group multiplication and the group action.
Clearly, $\grZ$ also acts on itself by left multiplication.

In this section we deal with the actions of two groups: $\grZ$ and $\Aut(\U/A)$.
Generic and persistent only refer to the action of $\grZ$.
We will always be explicit when we mention invariance.

Let $\psi({\mr x}\,;y)\in L(A)$.
We write $\phi({\mr x}\,;{\gr z}\,;y)$ for the formula $\psi({\gr z^{-1}}\cdot{\mr x}\,;y)$.
In this section $\Delta$ contains the formulas $\phi({\mr x}\,;{\gr z}\,;a)$ where $a$ ranges over some given $\Y\subseteq\U^y$ that is invariant over $A$.
Note that $\phi(\mrX\,;\grZ\,;a)$ is $\grZ$-invariant and that $\phi(\mrX\,;{\gr g}\,;a)={\gr g}\cdot\phi(\mrX\,;{\gr 1}\,;a)$ for every $a$.
Therefore the above $G$ and $\Delta$ are compatible with Assumption~\ref{notation_GXphi}.

Let ${\gr 1}$ be the identity of $\grZ$ which, for simplicity, we assume is a constant of $L$.

\begin{fact}
  There are some formulas $\gamma(y),\pi(y)\in L(A)$ such that, for every $a\in\U^y$

  \ceq{\hfill\gamma(a)}{\IFF}{\phi({\mr x}\,;{\gr 1}\,;a)\textrm{ is generic}}

  \ceq{\hfill\pi(a)}{\IFF}{\phi({\mr x}\,;{\gr 1}\,;a)\textrm{ is persistent}.}

  Similar claims holds for $\neg\phi({\mr x}\,;{\gr 1}\,;a)$.
\end{fact}

\begin{proof}
  By an easy argument of compactness, there is an $n$ such that if $\phi({\mr x}\,;{\gr 1}\,;a)$ is generic then it is also $n$-generic.
  Then

  \ceq{\hfill\gamma(y)}{=}{\E{\gr z_1},\dots,{\gr z_n}\ \A{\mr x}\bigvee_{i=1}^n\phi({\mr x}\,;{\gr z_i}\,;y)}

  The other claims follow easily.
\end{proof}

 
As $\phi({\mr x}\,;{\gr g}\,;a)$ is generic/persistent if and only if $\phi({\mr x}\,;{\gr 1}\,;a)$ is such, $\Aut(\U/A)$ maps generic/persistent sets of the form $\phi(\mrX\,;{\gr g}\,;a)$ to generic/persistent sets of the same form.
% The same is true for generic/persistent types $p({\mr x})\in S_\Delta(\grZ)$ in fact, up to equivalence, we may assume that they contain only formulas of the form $\phi({\mr x}\,;{\gr g}\,;a)$ and negation thereof.

\begin{fact}
  Let $p({\mr x})\in S_\Delta(\grZ)$ be persistent -- equivalently, $\grZ$-invariant. Then $p({\mr x})$ is invariant over $A$.
\end{fact}

\begin{proof}
  If $p({\mr x})$ is $\grZ$-invariant, $\phi({\mr x}\,;{\gr g}\,;a)\in p$ if and only if  $\phi({\mr x}\,;{\gr 1}\,;a)\in p$.
  As $\phi({\mr x}\,;{\gr 1}\,;a)\iff\phi({\mr x}\,;{\gr 1}\,;fa)$ for every $f\in\Aut(\U/A)$, invariance over $A$ follows.
\end{proof}

% The set $\mrD$ is $\Delta$-definable, namely it is definable by the formula $\phi({\mr x}\,;{\gr 1})$ where ${\gr 1}$ is the identity of $\mrG$.


% We define an immersion of 

% \ceq{\hfill\sigma\ :\ \Aut(\U/A)}{\to}{\grG}\\
% \ceq{\hfill f}{\mapsto}{f\gr1}

% \begin{fact}
%   Let $\mrD\subseteq\U^{\mr x}$ be definable over $A$.
%   Let $\phi({\mr x}\,;{\gr z})$ be the formula ${\mr x}\in{\gr z}\cdot\mrD$.
%   \begin{itemize}
%     \item[1.] $\phi({\mr x}\,;{\gr 1})$ is $\grG$-generic
%     \item[2.] $\mrD$ is generic over $A$.
%   \end{itemize}
% \end{fact}

\begin{assumption}
  We assume that the three equivalent conditions in Theorem~\ref{thm_coalesce} hold for $G=\grZ$, $\mrX$, and $\Delta$ introduced in this section.
\end{assumption}

Under this assumption the types $p({\mr x})\in S_\Delta(\grZ)$ that extend the maximal generic type $q({\mr x})$, see Remark~\ref{rem_coalesce}, are invariant under the action of both $\grZ$ and $\Aut(\U/A)$.

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Notes and references}

The connnections with topological dynamics are written on the wall but I ignored them until the very last.
I realized that \textit{persistent = thick\/} and that \textit{weakly persistent = piecewise syndetic.} 
Of course, \textit{generic = syndetic.}
The notion of \textit{hereditarely persistent\/} may also have an analogon in topological dynamics, but could not find it yet.

  \begin{biblist}[]\normalsize
    \bib{CK}{article}{
   author={Chernikov, Artem},
   author={Kaplan, Itay},
   title={Forking and dividing in ${\rm NTP}_2$ theories},
   journal={J. Symbolic Logic},
   volume={77},
   date={2012},
  %  number={1},
   pages={1--20},
  %  issn={0022-4812},
  %  review={\MR{2951626}},
  %  doi={10.2178/jsl/1327068688},
}
  \end{biblist}

  
\end{document}
